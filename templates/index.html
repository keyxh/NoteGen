<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown编辑器</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/github-markdown.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/highlight.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toolbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='lib/codemirror.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='lib/dialog.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- 左侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>文档列表</h2>
                <button id="new-doc-btn" class="btn btn-primary">新建文档</button>
            </div>
            <div class="document-list" id="document-list">
                <!-- 文档列表将通过JS动态加载 -->
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 顶部工具栏 -->
            <div class="toolbar">
                <button id="toggle-sidebar-btn" class="btn btn-icon" title="切换文档列表显示">
                    <span id="sidebar-toggle-icon">📋</span>
                </button>
                <input type="text" id="doc-title" class="doc-title" placeholder="文档标题">
                <div class="toolbar-actions">
                    <button id="save-btn" class="btn btn-primary">保存</button>
                    <button id="history-btn" class="btn btn-secondary">历史记录</button>
                    <button id="settings-btn" class="btn btn-secondary">设置</button>
                    <button id="about-btn" class="btn btn-secondary">关于</button>
                    <button id="export-md-btn" class="btn btn-secondary">导出MD</button>
                </div>
            </div>
            
            <!-- 编辑器和预览区 -->
            <div class="editor-container">
                <!-- 编辑器 -->
                <div class="editor-panel" id="editor-panel">
                    <div class="panel-header">
                        编辑器
                        <div class="panel-buttons">
                            <button id="toggle-ai-btn" class="btn btn-icon" title="切换AI助手显示">
                                <span id="ai-toggle-icon">🤖</span>
                            </button>
                            <button id="toggle-preview-btn" class="btn btn-icon" title="切换预览显示">
                                <span id="preview-toggle-icon">👁️</span>
                            </button>
                        </div>
                    </div>
                    <div class="editor-toolbar">
                        <button id="btn-bold" class="toolbar-btn" title="粗体 (Ctrl+B)">
                            <strong>B</strong>
                        </button>
                        <button id="btn-italic" class="toolbar-btn" title="斜体 (Ctrl+I)">
                            <em>I</em>
                        </button>
                        <button id="btn-strikethrough" class="toolbar-btn" title="删除线">
                            <s>S</s>
                        </button>
                        <div class="toolbar-divider"></div>
                        <button id="btn-h1" class="toolbar-btn" title="标题1">
                            H1
                        </button>
                        <button id="btn-h2" class="toolbar-btn" title="标题2">
                            H2
                        </button>
                        <button id="btn-h3" class="toolbar-btn" title="标题3">
                            H3
                        </button>
                        <div class="toolbar-divider"></div>
                        <button id="btn-link" class="toolbar-btn" title="链接">
                            链接
                        </button>
                        <button id="btn-image" class="toolbar-btn" title="图片">
                            图片
                        </button>
                        <div class="toolbar-divider"></div>
                        <button id="btn-code" class="toolbar-btn" title="行内代码">
                            &lt;/&gt;
                        </button>
                        <button id="btn-codeblock" class="toolbar-btn" title="代码块">
                            {;}
                        </button>
                        <div class="toolbar-divider"></div>
                        <button id="btn-ul" class="toolbar-btn" title="无序列表">
                            • 列表
                        </button>
                        <button id="btn-ol" class="toolbar-btn" title="有序列表">
                            1. 列表
                        </button>
                        <button id="btn-quote" class="toolbar-btn" title="引用">
                            "
                        </button>
                        <button id="btn-table" class="toolbar-btn" title="表格">
                            表格
                        </button>
                        <button id="btn-hr" class="toolbar-btn" title="水平线">
                            —
                        </button>
                    </div>
                    <textarea id="markdown-editor" placeholder="在此输入Markdown内容..."></textarea>
                </div>
                
                <!-- 可调整大小的分隔条 -->
                <div class="resize-separator" id="resize-separator"></div>
                
                <!-- 预览区 -->
                <div class="preview-panel" id="preview-panel">
                    <div class="panel-header">
                        预览
                    </div>
                    <div id="markdown-preview" class="markdown-body"></div>
                </div>
            </div>
        </div>
        
        <!-- 右侧AI助手 -->
        <div class="ai-sidebar" id="ai-sidebar">
            <div class="ai-header">
                <h3>AI助手</h3>
                <div class="ai-mode-toggle">
                    <button id="ai-mode-toggle" class="btn btn-secondary btn-small">切换到编辑模式</button>
                </div>
            </div>
            <div class="ai-chat-container">
                <div class="ai-messages" id="ai-messages">
                    <div class="ai-message system">欢迎使用AI助手！输入/开始对话</div>
                </div>
                <div class="ai-input-container">
                    <textarea id="ai-input" placeholder="输入消息..."></textarea>
                    <button id="send-ai-btn" class="btn btn-primary">发送</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 历史记录模态框 -->
    <div class="modal" id="history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>文档历史记录</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="history-list" id="history-list">
                    <!-- 历史记录将通过JS动态加载 -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- 设置模态框 -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>设置</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3 class="settings-section-title">AI配置</h3>
                    <div class="settings-grid">
                        <div class="settings-form-group">
                            <label for="api-key" class="settings-label">API Key</label>
                            <input type="password" id="api-key" class="settings-input" placeholder="输入您的API Key">
                            <div class="settings-description">用于访问AI服务的API密钥</div>
                        </div>
                        <div class="settings-form-group">
                            <label for="base-url" class="settings-label">Base URL</label>
                            <input type="text" id="base-url" class="settings-input" placeholder="https://api.openai.com/v1">
                            <div class="settings-description">AI服务的基础URL</div>
                        </div>
                    </div>
                    <div class="settings-grid">
                        <div class="settings-form-group">
                            <label for="model" class="settings-label">模型</label>
                            <input type="text" id="model" class="settings-input" placeholder="gpt-3.5-turbo">
                            <div class="settings-description">要使用的AI模型名称</div>
                        </div>
                        <div class="settings-form-group">
                            <label for="temperature" class="settings-label">温度 (0-2)</label>
                            <input type="range" id="temperature" class="settings-input" min="0" max="2" step="0.1" value="0.7">
                            <span id="temperature-value">0.7</span>
                            <div class="settings-description">控制输出的随机性，值越高越随机</div>
                        </div>
                    </div>
                    <div class="settings-grid">
                        <div class="settings-form-group">
                            <label for="max-tokens" class="settings-label">最大Token数</label>
                            <input type="number" id="max-tokens" class="settings-input" min="100" max="4096" value="1000">
                            <div class="settings-description">生成文本的最大长度</div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section-title">应用配置</h3>
                    <div class="settings-grid">
                        <div class="settings-form-group">
                            <label for="app-port" class="settings-label">端口</label>
                            <input type="number" id="app-port" class="settings-input" min="1000" max="65535" value="5000">
                            <div class="settings-description">应用运行的端口号</div>
                        </div>
                        <div class="settings-form-group">
                            <label for="auto-save-interval" class="settings-label">自动保存间隔(秒)</label>
                            <input type="number" id="auto-save-interval" class="settings-input" min="5" max="300" value="30">
                            <div class="settings-description">自动保存的时间间隔</div>
                        </div>
                    </div>
                    <div class="switch-group">
                        <label for="auto-save" class="switch-label">自动保存</label>
                        <label class="switch">
                            <input type="checkbox" id="auto-save" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-section-title">预览配置</h3>
                    <div class="settings-grid">
                        <div class="settings-form-group">
                            <label for="preview-theme" class="settings-label">预览主题</label>
                            <select id="preview-theme" class="settings-input">
                                <option value="github">GitHub</option>
                                <option value="vue">Vue</option>
                                <option value="material">Material</option>
                            </select>
                            <div class="settings-description">选择Markdown预览的主题样式</div>
                        </div>
                    </div>
                    <div class="switch-group">
                        <label for="sync-scroll" class="switch-label">同步滚动</label>
                        <label class="switch">
                            <input type="checkbox" id="sync-scroll" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="test-connection-btn" class="btn btn-secondary">测试连接</button>
                    <button id="save-settings-btn" class="btn btn-primary">保存设置</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 关于页面模态框 -->
    <div class="modal" id="about-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>关于 Markdown 编辑器</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-section">
                    <div class="about-info">
                        <h4>Markdown 编辑器</h4>
                        <p>一个简单易用的 Markdown 编辑器，支持实时预览、AI 助手和文档管理。</p>
                        <p>© 2023 Markdown Editor. All rights reserved.</p>
                    </div>
                </div>
                
                <div class="about-section">
                    <h4>功能</h4>
                    <ul>
                        <li>实时 Markdown 编辑和预览</li>
                        <li>AI 助手支持</li>
                        <li>文档管理和历史记录</li>
                        <li>多种主题和配置选项</li>
                        <li>日志管理和打包</li>
                    </ul>
                </div>
                
                <div class="about-section">
                    <h4>系统信息</h4>
                    <div class="system-info">
                        <div class="info-item">
                            <span class="info-label">版本:</span>
                            <span class="info-value" id="app-version">加载中...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">运行时间:</span>
                            <span class="info-value" id="app-uptime">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">日志文件大小:</span>
                            <span class="info-value" id="log-size">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="about-section">
                    <h4>操作</h4>
                    <div class="about-actions">
                        <button id="check-update-btn" class="btn btn-primary">检查更新</button>
                        <button id="view-logs-btn" class="btn btn-secondary">查看日志</button>
                        <button id="pack-logs-btn" class="btn btn-secondary">打包日志</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 日志查看模态框 -->
    <div class="modal" id="logs-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>系统日志</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="logs-controls">
                    <div class="form-group">
                        <label for="log-file-select">选择日志文件:</label>
                        <select id="log-file-select" class="form-control">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="log-search-input">搜索:</label>
                        <input type="text" id="log-search-input" class="form-control" placeholder="输入搜索关键词">
                    </div>
                    <div class="form-group">
                        <label for="log-lines-count">显示行数:</label>
                        <input type="number" id="log-lines-count" class="form-control" min="50" max="1000" value="100">
                    </div>
                    <div class="log-actions">
                        <button id="log-refresh-btn" class="btn btn-secondary">刷新</button>
                        <button id="log-search-btn" class="btn btn-secondary">搜索</button>
                        <button id="log-clear-btn" class="btn btn-warning">清空日志</button>
                        <button id="log-delete-btn" class="btn btn-danger">删除日志</button>
                    </div>
                </div>
                <div class="logs-container">
                    <pre id="log-content" class="log-content">加载日志内容中...</pre>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 加载脚本 -->
    <script src="{{ url_for('static', filename='lib/marked.min.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/purify.min.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/codemirror.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/markdown.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/xml.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/search.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/searchcursor.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/dialog.js') }}"></script>
    
    <!-- 图片上传隐藏输入框 -->
    <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
    
    <script>
        // 确保CodeMirror已经加载
        if (typeof window.CodeMirror === 'undefined') {
            console.error('CodeMirror not loaded');
        }
    </script>
    <script src="{{ url_for('static', filename='lib/markdown-toolbar.js') }}"></script>
    <script>
        // 确保markdown-toolbar已经加载
        if (typeof window.CodeMirror === 'undefined') {
            console.error('CodeMirror still not loaded after markdown-toolbar');
        }
    </script>
    <script src="{{ url_for('static', filename='js/ai-assistant.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>